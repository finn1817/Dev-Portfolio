<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dan Finn - Portfolio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            --text-color: #ffffff;
            --accent-color: #3b82f6;
            --secondary-color: #6366f1;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --nav-bg: rgba(0, 0, 0, 0.8);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --bg-gradient: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            --text-color: #2d3748;
            --accent-color: #3b82f6;
            --secondary-color: #6366f1;
            --card-bg: rgba(255, 255, 255, 0.8);
            --border-color: rgba(0, 0, 0, 0.1);
            --nav-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        [data-theme="blackout"] {
            --bg-gradient: linear-gradient(135deg, #000000 0%, #0a0a0a 100%);
            --text-color: #ffffff;
            --accent-color: #00ff00;
            --secondary-color: #ff0040;
            --card-bg: rgba(0, 0, 0, 0.8);
            --border-color: rgba(0, 255, 0, 0.3);
            --nav-bg: rgba(0, 0, 0, 0.95);
            --shadow: 0 8px 32px rgba(0, 255, 0, 0.2);
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
            overflow-x: hidden;
            min-height: 100vh;
            padding-top: 62px; /* ensure fixed nav does not cover content */
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        .nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 0.5rem 1.2rem; /* reduced padding */
            background: var(--nav-bg);
            backdrop-filter: blur(12px);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            height: 60px;
        }

        .logo {
            font-size: 1.2rem; /* smaller logo */
            font-weight: 800;
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logo:hover {
            opacity: 0.8;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
        }

        .left { display: flex; align-items: center; gap: 0.75rem; }
        .auth-button { background: transparent; color: var(--text-color); border: 1px solid var(--border-color); padding: 0.35rem 0.8rem; border-radius: 20px; cursor: pointer; font-size: 0.85rem; }
        .auth-button:hover { border-color: var(--accent-color); color: var(--accent-color); }

        /* Auth Modal Styles */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .auth-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .auth-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(20px);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .auth-modal.active .auth-card {
            transform: scale(1);
        }

        .auth-card h3 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--text-color);
            font-size: 1.5rem;
        }

        .auth-input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            margin-bottom: 0.5rem;
            transition: border-color 0.3s ease;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .auth-input::placeholder {
            color: var(--text-color);
            opacity: 0.6;
        }

        .auth-row {
            display: flex;
            gap: 0.5rem;
        }

        .auth-row .auth-input {
            flex: 1;
        }

        .auth-hint {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 1rem;
            text-align: center;
        }

        .auth-actions {
            display: flex;
            gap: 0.8rem;
            justify-content: space-between;
        }

        .auth-primary, .auth-secondary {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-primary {
            background: var(--accent-color);
            color: white;
        }

        .auth-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .auth-secondary {
            background: transparent;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .auth-secondary:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .auth-mode-toggle {
            text-align: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .auth-toggle-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
        }

        .auth-toggle-btn:hover {
            color: var(--secondary-color);
        }

        .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            border: 2px solid transparent;
        }

        .nav-links a:hover {
            color: var(--accent-color);
            border-color: var(--accent-color);
            background: rgba(59, 130, 246, 0.1);
        }

        .nav-links a.active {
            color: var(--accent-color);
            border-color: var(--accent-color);
            background: rgba(59, 130, 246, 0.2);
        }

        .theme-toggle {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: var(--shadow);
        }

        .theme-toggle:hover {
            opacity: 0.9;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .hero {
            min-height: calc(100vh - 62px); /* account for fixed nav */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* start a little lower so not covered */
            align-items: center;
            text-align: center;
            position: relative;
            padding: 2.2rem 2rem 2rem; /* ensure breathing room */
            margin-top: 8px;
        }

        .hero h1 {
            font-size: 3rem; /* reduced title size */
            margin-bottom: 0.6rem;
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color), #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 3s ease-in-out infinite alternate;
            font-weight: 800;
            text-shadow: 0 0 18px rgba(0, 255, 136, 0.2);
        }

        @keyframes glow {
            from { 
                filter: brightness(1) drop-shadow(0 0 10px rgba(0, 255, 136, 0.3)); 
                transform: scale(1);
            }
            to { 
                filter: brightness(1.3) drop-shadow(0 0 20px rgba(0, 255, 136, 0.6)); 
                transform: scale(1.02);
            }
        }

        .hero .subtitle {
            font-size: 1.05rem; /* reduced subtitle */
            margin-bottom: 2rem;
            opacity: 0.9;
            font-weight: 300;
            background: linear-gradient(45deg, var(--text-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cta-button {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            border: none;
            padding: 1.2rem 3rem;
            border-radius: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            transition: left 0.5s ease;
        }

        .cta-button:hover::before {
            left: 100%;
        }

        .cta-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.4);
        }

        .section {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 1.5rem 0;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color));
        }

        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 255, 136, 0.2);
            border-color: var(--accent-color);
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .skill-card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .skill-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            opacity: 0.1;
            transition: left 0.5s ease;
        }

        .skill-card:hover::before {
            left: 0;
        }

        .skill-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--shadow);
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .project-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2.5rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .project-card:hover::before {
            transform: scaleX(1);
        }

        .project-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--accent-color);
            box-shadow: var(--shadow);
        }

        .terminal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90vw;
            max-width: 1200px;
            height: 80vh;
            max-height: 800px;
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
            border: 2px solid var(--accent-color);
            border-radius: 20px;
            z-index: 2000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            font-family: 'Fira Code', 'Courier New', monospace;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6), 
                        0 0 0 1px rgba(0, 255, 136, 0.2),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            opacity: 0;
            visibility: hidden;
            backdrop-filter: blur(20px);
        }

        .terminal.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }

        .terminal-header {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            color: #000;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 18px 18px 0 0;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .terminal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: #000;
            font-size: 1.5rem;
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .terminal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .terminal-body {
            padding: 1.5rem;
            height: calc(100% - 80px);
            overflow-y: auto;
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
            color: var(--accent-color);
            font-size: 1rem;
            line-height: 1.6;
        }

        .terminal-body::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .terminal-body::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        [data-theme="blackout"] .terminal {
            background: linear-gradient(145deg, #000000, #0a0a0a);
            border-color: #00ff00;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.9), 
                        0 0 0 1px rgba(0, 255, 0, 0.5),
                        inset 0 1px 0 rgba(0, 255, 0, 0.2);
        }

        [data-theme="blackout"] .terminal-header {
            background: linear-gradient(45deg, #00ff00, #ff0040);
        }

        [data-theme="blackout"] .terminal-body {
            background: linear-gradient(145deg, #000000, #0a0a0a);
            color: #00ff00;
        }

        [data-theme="blackout"] .nav {
            background: rgba(0, 0, 0, 0.98);
            border-bottom-color: rgba(0, 255, 0, 0.3);
        }

        [data-theme="blackout"] .hero h1 {
            text-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .terminal-input {
            display: flex;
            margin-top: 1rem;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 8px;
            padding: 0.5rem;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .terminal-prompt {
            color: var(--accent-color);
            margin-right: 0.8rem;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .terminal-input input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--accent-color);
            font-family: 'Fira Code', 'Courier New', monospace;
            outline: none;
            font-size: 1rem;
            font-weight: 500;
        }

        .terminal-input input::placeholder {
            color: rgba(0, 255, 136, 0.5);
        }

        .contact-form {
            max-width: 600px;
            margin: 2rem auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.8rem;
            color: var(--accent-color);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 1.2rem;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            color: var(--text-color);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
            transform: translateY(-2px);
        }

        .rate-limit {
            margin-top: 1rem;
            padding: 0.5rem;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 4px;
            text-align: center;
        }

        .matrix-mode {
            background: #000 !important;
            color: #00ff41 !important;
        }

        .matrix-mode .card {
            background: rgba(0, 255, 65, 0.1) !important;
            border-color: #00ff41 !important;
        }

        .floating-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            z-index: 1500;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-button:hover {
            transform: scale(1.15) rotate(10deg);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.4);
        }

        .floating-button:active {
            transform: scale(0.95);
        }

        .dev-panel {
            position: fixed;
            top: 80px;
            right: -400px;
            width: 380px;
            height: calc(100vh - 100px);
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px 0 0 8px;
            z-index: 1000;
            transition: all 0.3s ease;
            overflow-y: auto;
            padding: 1rem;
            backdrop-filter: blur(20px);
            display: none; /* Hidden by default */
        }

        .dev-panel.active {
            right: 0;
        }

        .dev-panel.enabled {
            display: block; /* Only show when dev mode is enabled */
        }

        .analytics-widget {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .btn {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1rem;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, var(--secondary-color), #ff8a80);
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: var(--accent-color);
            color: var(--bg-color);
            border-radius: 4px;
            z-index: 2000;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* SPA Section Management */
        .section-content {
            display: none;
            transition: opacity 0.3s ease;
        }

        .section-content.active {
            display: block;
            opacity: 1;
        }

        #dynamic-content iframe {
            width: 100%;
            border: none;
            min-height: 100vh;
            background: transparent;
        }

        @media (max-width: 768px) {
            .nav {
                padding: 1rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .terminal {
                width: 95%;
            }
            
            .dev-panel {
                width: 100%;
                right: -100%;
            }
        }
    </style>
</head>
<body>
    <canvas class="matrix-bg" id="matrixCanvas"></canvas>
    
    <nav class="nav">
        <div class="left"><div class="logo">DF</div><button class="auth-button" id="authBtn" onclick="openAuth()">Sign In</button><span id="authStatus" style="display:none; font-size:0.9rem; opacity:0.85; margin-left:6px;"></span></div>
        <ul class="nav-links">
            <li><a href="#" onclick="showSection('home')" class="nav-tab active" data-section="home">Home</a></li>
            <li><a href="#" onclick="showSection('about')" class="nav-tab" data-section="about">About</a></li>
            <li><a href="#" onclick="showSection('projects')" class="nav-tab" data-section="projects">Projects</a></li>
            <li><a href="#" onclick="showSection('contact')" class="nav-tab" data-section="contact">Contact</a></li>
        </ul>
        <button class="theme-toggle" onclick="toggleTheme()">🌙 Dark</button>
    </nav>

    <!-- Main Content Container -->
    <div id="main-content">
        <!-- Home Section (default visible) -->
        <section id="home" class="hero section-content active">
            <h1>Dan Finn</h1>
            <p class="subtitle">Student Developer & Code Wizard</p>
            <button class="cta-button" onclick="showSection('projects')">View My Work ✨</button>
            <div style="margin-top: 2rem;">
                <button class="btn" onclick="activateTerminal()">🔧 Terminal</button>
                <button class="btn btn-secondary" id="dev-panel-btn" onclick="toggleDevPanel()" style="display: none;">📊 Dev Panel</button>
                <button class="btn" onclick="location.href='begin/index.html'">🎯 Find Easter Egg</button>
            </div>
        </section>

        <!-- Dynamic Content Container for loaded pages -->
        <div id="dynamic-content" class="section-content">
            <!-- About Section Content (embedded) -->
            <div id="about-content" class="embedded-section" style="display: none;">
                <div class="section">
                    <div class="card">
                        <h2>About Me 👨‍💻</h2>
                        <p>I'm a Student Programmer that's always working on different web projects. I work on coding my own helpful and fun projects to get better at what I do, all with user-friendly design, and... 🎯 lots of hidden surprises!</p>
                        
                        <div class="skills-grid">
                            <div class="skill-card">
                                <h3>HTML, CSS, & JS</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>Database Experience</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>Python</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>C++</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>Auth & Security</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>AI Integration</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>Dynamic web Dev ability</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>AI - For Planning & In Dev</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                            <div class="skill-card">
                                <h3>UI - Functionality & Appearance</h3>
                                <div class="skill-level">⭐⭐⭐⭐⭐</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Section Content (embedded) -->
            <div id="projects-content" class="embedded-section" style="display: none;">
                <div class="section">
                    <h2>My Projects</h2>
                    <div class="projects-grid">
                        <div class="project-card">
                            <h3>🎮 Secret Game Project</h3>
                            <p>A mysterious project that... only appears when you solve the puzzle</p>
                            <button class="btn" onclick="unlockSecretProject()">Learn More</button>
                        </div>
                        <div class="project-card">
                            <h3>💻 Code Inspector Tool</h3>
                            <p>Perfect for developers who love to peek behind the curtain!</p>
                            <button class="btn" onclick="inspectCode()">View Project</button>
                        </div>
                        <div class="project-card">
                            <h3>🔍 Easter Egg Hunter</h3>
                            <p>A tool for finding hidden gems in websites... just like this one!</p>
                            <button class="btn" onclick="huntEasterEggs()">Explore</button>
                        </div>
                        <div class="project-card">
                            <h3>🚀 Real-time Analytics</h3>
                            <p>Live tracking and analytics dashboard with Firebase integration</p>
                            <button class="btn" onclick="showAnalytics()">View Analytics</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Section (kept on main page) -->
        <section id="contact" class="section section-content">
            <div class="card">
                <h2>Get In Touch</h2>
                <p>Found all the easter eggs? Send me a message!</p>
                
                <form class="contact-form" id="contactForm">
                    <div class="form-group">
                        <label for="name">Name:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="message">Message:</label>
                        <textarea id="message" name="message" rows="5" maxlength="2000" required></textarea>
                        <div class="char-counter"><span id="charCount">0</span>/2000 characters</div>
                    </div>
                    <button type="submit" class="btn">Send Message 🚀</button>
                </form>
                
                <div class="rate-limit">
                    Rate limit: <span id="submissionCount">0</span>/5 in the last 2 minutes
                </div>
            </div>
        </section>
    </div>

    <div class="terminal" id="terminal">
        <div class="terminal-header">
            <span>🎯 EASTER EGG TERMINAL ACTIVATED!</span>
            <button class="terminal-close" onclick="closeTerminal()">×</button>
        </div>
        <div class="terminal-body" id="terminalOutput">
            <div>Welcome to Dan's Portfolio Terminal v2.0</div>
            <div>Type 'help' for available commands</div>
            <div>Super Dev Mode: Type 'sudo dev-mode --enable' to unlock advanced features</div>
        </div>
        <div class="terminal-input">
            <span class="terminal-prompt">user@portfolio:~$</span>
            <input type="text" id="terminalInput" onkeypress="handleTerminalInput(event)">
        </div>
    </div>

    <div class="dev-panel" id="devPanel">
        <h3>🔧 Developer Panel</h3>
        <div class="analytics-widget">
            <h4>📊 Live Analytics</h4>
            <p>Page Views: <span id="pageViews">Loading...</span></p>
            <p>Active Users: <span id="activeUsers">Loading...</span></p>
            <p>Messages Sent: <span id="messageCount">Loading...</span></p>
            <button class="btn" onclick="refreshAnalytics()">Refresh</button>
        </div>
        
        <div class="analytics-widget">
            <h4>🎯 Easter Eggs Found</h4>
            <p>Total: <span id="easterEggCount">0</span></p>
            <button class="btn" onclick="resetEasterEggs()">Reset</button>
        </div>

        <div class="analytics-widget">
            <h4>⚡ Quick Actions</h4>
            <button class="btn" onclick="exportData()">Export Data</button>
            <button class="btn btn-secondary" onclick="clearCache()">Clear Cache</button>
            <button class="btn" onclick="testConnection()">Test Firebase</button>
        </div>
    </div>

    <button class="floating-button" onclick="activateTerminal()" title="Open Terminal">
        🔧
    </button>

    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-card">
            <h3 id="authTitle">Sign In</h3>
            <input id="authUsername" class="auth-input" placeholder="Username (e.g., Testuser)">
            <input id="authPassword" class="auth-input" placeholder="Password" type="password" style="margin-top:0.5rem;">
            <input id="authConfirmPassword" class="auth-input" placeholder="Confirm Password" type="password" style="margin-top:0.5rem; display:none;">
            <div class="auth-row" style="margin-top:0.5rem;">
                <input id="authName" class="auth-input" placeholder="Name (optional)">
                <input id="authPhone" class="auth-input" placeholder="Phone (optional)">
            </div>
            <div class="auth-hint" id="authHint">Password must be 4+ chars and include Uppercase, Lowercase, Number, and Special character.</div>
            <div class="auth-actions">
                <button class="auth-secondary" onclick="closeAuth()">Cancel</button>
                <button class="auth-primary" id="authSubmitBtn" onclick="handleAuth()">Sign In</button>
            </div>
            <div class="auth-mode-toggle">
                <span id="authModeText">Don't have an account?</span>
                <button class="auth-toggle-btn" id="authToggleBtn" onclick="toggleAuthMode()">Create Account</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase Configuration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, where, updateDoc, deleteDoc, doc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCejm0Ry18S1mlqYpnMRuIJGnQ-iDvu3EU",
            authDomain: "custom-messages-84ec4.firebaseapp.com",
            projectId: "custom-messages-84ec4",
            storageBucket: "custom-messages-84ec4.firebasestorage.app",
            messagingSenderId: "1079020496100",
            appId: "1:1079020496100:web:d21ec1428327515e3df8f1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global variables
        let devModeEnabled = false;
        let easterEggsFound = 0;
        let submissionCount = parseInt(localStorage.getItem('submissionCount') || '0');
        let lastSubmissionTime = parseInt(localStorage.getItem('lastSubmissionTime') || '0');
        let sessionId = generateSessionId();
    let commandHistory = [];
    let currentUser = null;

        // Cookie helpers (fallback for auth persistence)
        function setCookie(name, value, days = 30) {
            const expires = new Date(Date.now() + days * 864e5).toUTCString();
            document.cookie = `${name}=${encodeURIComponent(value)}; Expires=${expires}; Path=/; SameSite=Lax`;
        }

        function getCookie(name) {
            return document.cookie
                .split('; ')
                .find(row => row.startsWith(name + '='))
                ?.split('=')[1];
        }

        function deleteCookie(name) {
            document.cookie = `${name}=; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Path=/; SameSite=Lax`;
        }

        // Robust auth functions
        function loadUserFromStorage() {
            try {
                const stored = localStorage.getItem('auth_user');
                console.log('Raw localStorage auth_user:', stored);
                
                if (!stored || stored === 'null' || stored === 'undefined') {
                    // Try cookie fallback
                    const cookieVal = getCookie('auth_user');
                    if (cookieVal) {
                        try {
                            currentUser = JSON.parse(decodeURIComponent(cookieVal));
                            console.log('Loaded user from cookie:', currentUser);
                            // Sync back to localStorage for future
                            localStorage.setItem('auth_user', JSON.stringify(currentUser));
                            return true;
                        } catch (e) {
                            console.warn('Failed parsing cookie auth_user:', e);
                        }
                    }
                    currentUser = null;
                    return false;
                }
                
                currentUser = JSON.parse(stored);
                console.log('Parsed currentUser:', currentUser);
                return currentUser !== null;
            } catch (e) {
                console.error('Failed to parse auth_user from localStorage:', e);
                currentUser = null;
                localStorage.removeItem('auth_user'); // Clear corrupted data
                deleteCookie('auth_user');
                return false;
            }
        }

        function saveUserToStorage(user) {
            if (user) {
                currentUser = user;
                localStorage.setItem('auth_user', JSON.stringify(user));
                setCookie('auth_user', JSON.stringify(user));
                console.log('Saved user to localStorage:', user);
            } else {
                currentUser = null;
                localStorage.removeItem('auth_user');
                deleteCookie('auth_user');
                console.log('Removed user from localStorage');
            }
        }

        // SPA Management
        let currentSection = 'home';

        // SPA Functions
        window.showSection = async function(section) {
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            // Add active class to clicked tab
            document.querySelector(`[data-section="${section}"]`).classList.add('active');
            
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.embedded-section').forEach(content => content.style.display = 'none');
            
            // Update current section
            currentSection = section;
            
            if (section === 'home') {
                document.getElementById('home').classList.add('active');
            } else if (section === 'contact') {
                document.getElementById('contact').classList.add('active');
            } else if (section === 'about') {
                document.getElementById('dynamic-content').classList.add('active');
                document.getElementById('about-content').style.display = 'block';
                trackSectionView('about');
            } else if (section === 'projects') {
                document.getElementById('dynamic-content').classList.add('active');
                document.getElementById('projects-content').style.display = 'block';
                trackSectionView('projects');
            }
        };

        // Track section views
        async function trackSectionView(section) {
            try {
                await addDoc(collection(db, 'page_views'), {
                    section: section,
                    timestamp: serverTimestamp(),
                    userAgent: navigator.userAgent,
                    sessionId: sessionId
                });
            } catch (error) {
                console.log('Analytics tracking failed:', error);
            }
        }

        // Attempt load immediately so UI using currentUser has state ASAP
        loadUserFromStorage();

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            // Ensure state is present (in case DOMContentLoaded is late/early)
            if (!currentUser) loadUserFromStorage();
            initializeMatrix();
            trackPageView();
            updateSubmissionCount();
            loadEasterEggCount();
            setupRealTimeListeners();
            initializeDemoAccount(); // Initialize demo account
            
            // Setup form handlers
            document.getElementById('contactForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('message').addEventListener('input', updateCharCount);
            
            // Setup theme from localStorage
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton();
            if (typeof updateAuthUI === 'function') updateAuthUI();
        });

        // Firebase Functions
        async function trackPageView() {
            try {
                await addDoc(collection(db, 'analytics'), {
                    type: 'page_view',
                    page: 'index',
                    timestamp: serverTimestamp(),
                    sessionId: sessionId,
                    userAgent: navigator.userAgent
                });
            } catch (error) {
                console.error('Error tracking page view:', error);
            }
        }

        async function saveMessage(messageData) {
            try {
                const docRef = await addDoc(collection(db, 'messages'), {
                    ...messageData,
                    timestamp: serverTimestamp(),
                    sessionId: sessionId
                });
                showNotification('Message sent successfully! 🎉');
                return docRef.id;
            } catch (error) {
                console.error('Error saving message:', error);
                showNotification('Error sending message. Please try again.', 'error');
                throw error;
            }
        }

        async function logEasterEgg(eggType) {
            try {
                if (!currentUser) return; // only store for signed-in users
                const uid = currentUser.username;
                await addDoc(collection(db, `users/${uid}/events`), {
                    type: eggType,
                    timestamp: serverTimestamp(),
                    sessionId: sessionId
                });
                easterEggsFound++;
                localStorage.setItem('easterEggsFound', easterEggsFound.toString());
                updateEasterEggCount();
            } catch (error) {
                console.error('Error logging easter egg:', error);
            }
        }

        async function saveCommand(command, output) {
            try {
                if (!currentUser) return; // only when signed in
                const uid = currentUser.username;
                await addDoc(collection(db, `users/${uid}/command_history`), {
                    command: command,
                    output: output,
                    timestamp: serverTimestamp(),
                    sessionId: sessionId,
                    devMode: devModeEnabled
                });
            } catch (error) {
                console.error('Error saving command:', error);
            }
        }

        // Auth UI helpers (demo only; not secure)
        let isCreateMode = false;
        
        window.openAuth = function() { 
            document.getElementById('authModal').classList.add('active'); 
            resetAuthModal();
        };
        
        window.closeAuth = function() { 
            document.getElementById('authModal').classList.remove('active'); 
            resetAuthModal();
        };

        function resetAuthModal() {
            isCreateMode = false;
            document.getElementById('authTitle').textContent = 'Sign In';
            document.getElementById('authSubmitBtn').textContent = 'Sign In';
            document.getElementById('authModeText').textContent = "Don't have an account?";
            document.getElementById('authToggleBtn').textContent = 'Create Account';
            document.getElementById('authConfirmPassword').style.display = 'none';
            document.getElementById('authHint').textContent = 'Password must be 4+ chars and include Uppercase, Lowercase, Number, and Special character.';
            
            // Clear form fields
            document.getElementById('authUsername').value = '';
            document.getElementById('authPassword').value = '';
            document.getElementById('authConfirmPassword').value = '';
            document.getElementById('authName').value = '';
            document.getElementById('authPhone').value = '';
        }

        window.toggleAuthMode = function() {
            isCreateMode = !isCreateMode;
            
            if (isCreateMode) {
                document.getElementById('authTitle').textContent = 'Create Account';
                document.getElementById('authSubmitBtn').textContent = 'Create Account';
                document.getElementById('authModeText').textContent = 'Already have an account?';
                document.getElementById('authToggleBtn').textContent = 'Sign In';
                document.getElementById('authConfirmPassword').style.display = 'block';
                document.getElementById('authHint').textContent = 'Choose a unique username. Password must be 4+ chars and include Uppercase, Lowercase, Number, and Special character.';
            } else {
                resetAuthModal();
            }
        };

        // Demo account initialization
        async function initializeDemoAccount() {
            try {
                const usersQuery = query(
                    collection(db, 'users'), 
                    where('username', '==', 'Testuser'), 
                    limit(1)
                );
                const snapshot = await getDocs(usersQuery);
                
                if (snapshot.empty) {
                    // Create demo account if it doesn't exist
                    await addDoc(collection(db, 'users'), { 
                        username: 'Testuser', 
                        password: btoa('Password1!'),
                        name: 'Demo User', 
                        phone: null, 
                        createdAt: serverTimestamp(),
                        accountType: 'demo',
                        lastLogin: serverTimestamp()
                    });
                    console.log('Demo account initialized');
                }
            } catch (error) {
                console.log('Demo account initialization failed:', error);
            }
        }

        function updateAuthUI() {
            const status = document.getElementById('authStatus');
            const btn = document.getElementById('authBtn');
            if (!status || !btn) return;
            if (currentUser) {
                status.style.display = 'inline';
                status.textContent = `Signed in as ${currentUser.username}`;
                btn.textContent = 'Sign Out';
                btn.onclick = () => { saveUserToStorage(null); updateAuthUI(); };
            } else {
                status.style.display = 'none';
                status.textContent = '';
                btn.textContent = 'Sign In';
                btn.onclick = openAuth;
            }
        }

        function validPassword(pw) {
            return /[A-Z]/.test(pw) && /[a-z]/.test(pw) && /\d/.test(pw) && /[^A-Za-z0-9]/.test(pw) && pw.length >= 4;
        }

        // Check if username already exists
        async function checkUsernameExists(username) {
            try {
                const usersQuery = query(collection(db, 'users'), where('username', '==', username), limit(1));
                const snapshot = await getDocs(usersQuery);
                return !snapshot.empty;
            } catch (error) {
                console.error('Error checking username:', error);
                return false;
            }
        }

        window.handleAuth = async function() {
            const username = document.getElementById('authUsername').value.trim();
            const password = document.getElementById('authPassword').value;
            const confirmPassword = document.getElementById('authConfirmPassword').value;
            const name = document.getElementById('authName').value.trim();
            const phone = document.getElementById('authPhone').value.trim();

            // Validation
            if (!username) { 
                showNotification('Username required', 'error'); 
                return; 
            }
            
            if (username.length < 3) {
                showNotification('Username must be at least 3 characters', 'error');
                return;
            }
            
            if (!validPassword(password)) { 
                showNotification('Password must include upper, lower, number, special and be 4+ chars', 'error'); 
                return; 
            }

            if (isCreateMode) {
                // Create Account mode
                if (password !== confirmPassword) {
                    showNotification('Passwords do not match', 'error');
                    return;
                }

                // Check if username already exists
                const userExists = await checkUsernameExists(username);
                if (userExists) {
                    showNotification('Username already exists. Please choose a different one.', 'error');
                    return;
                }

                // Create new account
                try {
                    await addDoc(collection(db, 'users'), { 
                        username, 
                        password: btoa(password), // Basic encoding (not secure for production)
                        name: name || null, 
                        phone: phone || null, 
                        createdAt: serverTimestamp(),
                        accountType: 'created',
                        lastLogin: serverTimestamp()
                    });
                    
                    currentUser = { username };
                    saveUserToStorage(currentUser);
                    closeAuth();
                    updateAuthUI();
                    showNotification(`Account created successfully! Welcome, ${username}!`);
                    
                    // Track account creation
                    try {
                        await addDoc(collection(db, 'users', username, 'events'), {
                            type: 'account_created',
                            timestamp: serverTimestamp(),
                            sessionId: sessionId
                        });
                    } catch (_) {}
                    
                } catch (error) {
                    console.error('Error creating account:', error);
                    showNotification('Error creating account. Please try again.', 'error');
                }
            } else {
                // Sign In mode
                try {
                    // Check if user exists and password matches
                    const usersQuery = query(
                        collection(db, 'users'), 
                        where('username', '==', username), 
                        limit(1)
                    );
                    const snapshot = await getDocs(usersQuery);
                    
                    if (snapshot.empty) {
                        showNotification('Username not found. Please create an account first.', 'error');
                        return;
                    }
                    
                    // Verify password
                    const userData = snapshot.docs[0].data();
                    const storedPassword = atob(userData.password || '');
                    
                    if (storedPassword !== password) {
                        showNotification('Incorrect password', 'error');
                        return;
                    }
                    
                    // Update last login
                    try {
                        await updateDoc(snapshot.docs[0].ref, {
                            lastLogin: serverTimestamp()
                        });
                    } catch (_) {}

                    currentUser = { username };
                    saveUserToStorage(currentUser);
                    closeAuth();
                    updateAuthUI();
                    showNotification(`Welcome back, ${username}!`);
                    
                    // Track sign in
                    try {
                        await addDoc(collection(db, 'users', username, 'events'), {
                            type: 'sign_in',
                            timestamp: serverTimestamp(),
                            sessionId: sessionId
                        });
                    } catch (_) {}
                    
                } catch (error) {
                    console.error('Error signing in:', error);
                    showNotification('Error signing in. Please try again.', 'error');
                }
            }
        };

        async function getAnalytics() {
            try {
                const analytics = {
                    pageViews: 0,
                    messageCount: 0,
                    easterEggCount: 0,
                    activeUsers: 0
                };

                // Get page views
                const pageViewsQuery = query(collection(db, 'analytics'), orderBy('timestamp', 'desc'), limit(100));
                const pageViewsSnapshot = await getDocs(pageViewsQuery);
                analytics.pageViews = pageViewsSnapshot.docs.length;

                // Get unique sessions (active users)
                const uniqueSessions = new Set();
                pageViewsSnapshot.docs.forEach(doc => {
                    if (doc.data().sessionId) {
                        uniqueSessions.add(doc.data().sessionId);
                    }
                });
                analytics.activeUsers = uniqueSessions.size;

                // Get message count
                const messagesQuery = query(collection(db, 'messages'), orderBy('timestamp', 'desc'), limit(50));
                const messagesSnapshot = await getDocs(messagesQuery);
                analytics.messageCount = messagesSnapshot.docs.length;

                // Get easter egg count (user-scoped only)
                analytics.easterEggCount = 0;
                if (currentUser) {
                    try {
                        const eggsSnap = await getDocs(query(collection(db, 'users', currentUser.username, 'events'), orderBy('timestamp', 'desc'), limit(50)));
                        analytics.easterEggCount = eggsSnap.docs.filter(d => !!d.data().type || d.data().action === 'hunt_started').length;
                    } catch (_) { /* ignore */ }
                }

                return analytics;
            } catch (error) {
                console.error('Error getting analytics:', error);
                return null;
            }
        }

        // Hunt progress tracking
        async function getHuntProgress() {
            if (!currentUser) {
                return `🎯 HUNT PROGRESS TRACKING

❌ Not signed in! Sign in to track your easter egg hunt progress.

To sign in:
1. Click the "Sign In" button (top-left)
2. Create an account or use demo: Testuser / Password1!
3. Your progress will be automatically tracked across all hunt pages

Once signed in, this command will show:
• Current hunt level reached
• Total advancement progress  
• Easter eggs discovered
• Achievements unlocked`;
            }

            try {
                // Get hunt progress
                const progressQuery = query(
                    collection(db, 'users', currentUser.username, 'hunt_progress'), 
                    orderBy('timestamp', 'desc'), 
                    limit(10)
                );
                const progressSnap = await getDocs(progressQuery);
                
                // Get events
                const eventsQuery = query(
                    collection(db, 'users', currentUser.username, 'events'), 
                    orderBy('timestamp', 'desc'), 
                    limit(20)
                );
                const eventsSnap = await getDocs(eventsQuery);

                let highestLevel = 'start';
                let completedLevels = new Set();
                let totalEvents = eventsSnap.docs.length;
                let achievements = [];

                // Analyze progress
                progressSnap.docs.forEach(doc => {
                    const data = doc.data();
                    if (data.level) {
                        if (data.level.includes('advancement-four')) {
                            highestLevel = 'COMPLETE';
                            completedLevels.add('four');
                        } else if (data.level.includes('advancement-three') && highestLevel !== 'COMPLETE') {
                            highestLevel = 'advancement-three';
                            completedLevels.add('three');
                        } else if (data.level.includes('advancement-two') && !highestLevel.includes('three') && highestLevel !== 'COMPLETE') {
                            highestLevel = 'advancement-two';
                            completedLevels.add('two');
                        } else if (data.level.includes('advancement-one') && highestLevel === 'start') {
                            highestLevel = 'advancement-one';
                            completedLevels.add('one');
                        }
                    }
                });

                // Check for achievements
                eventsSnap.docs.forEach(doc => {
                    const data = doc.data();
                    if (data.type === 'console_access_hunt_page') achievements.push('🕵️ Console Detective');
                    if (data.type === 'advancement_completed') achievements.push('🏆 Chain Master');
                    if (data.action === 'hunt_started') achievements.push('🎯 Hunt Initiated');
                });

                // Remove duplicates
                achievements = [...new Set(achievements)];

                let progressPercentage = 0;
                if (highestLevel === 'COMPLETE') progressPercentage = 100;
                else if (highestLevel.includes('three')) progressPercentage = 75;
                else if (highestLevel.includes('two')) progressPercentage = 50;
                else if (highestLevel.includes('one')) progressPercentage = 25;

                return `🎯 HUNT PROGRESS TRACKING - ${currentUser.username}

📊 ADVANCEMENT PROGRESS:
• Current Level: ${highestLevel.toUpperCase()}
• Progress: ${progressPercentage}% (${completedLevels.size}/4 levels)
• Completed Levels: ${Array.from(completedLevels).join(', ') || 'none'}

🎮 ACTIVITY SUMMARY:
• Total Hunt Events: ${totalEvents}
• Easter Eggs Found: ${eventsSnap.docs.filter(d => !!d.data().type).length}
• Pages Visited: ${progressSnap.docs.length}

🏆 ACHIEVEMENTS UNLOCKED:
${achievements.length > 0 ? achievements.map(a => `• ${a}`).join('\n') : '• No achievements yet'}

💡 TIPS:
${highestLevel === 'start' ? '• Visit begin/index.html to start the hunt' : ''}
${progressPercentage < 100 ? '• Continue through the advancement chain' : ''}
${achievements.length < 3 ? '• Explore more to unlock achievements' : ''}
${progressPercentage === 100 ? '• 🎉 Congratulations! You completed the advancement chain!' : ''}`;

            } catch (error) {
                console.error('Error getting hunt progress:', error);
                return '❌ Error loading hunt progress. Please try again.';
            }
        }

        // Real-time listeners
        function setupRealTimeListeners() {
            // Listen for new messages
            const messagesQuery = query(collection(db, 'messages'), orderBy('timestamp', 'desc'), limit(10));
            onSnapshot(messagesQuery, (snapshot) => {
                if (devModeEnabled) {
                    console.log('New messages received:', snapshot.docs.length);
                }
            });

            // Listen for analytics updates
            const analyticsQuery = query(collection(db, 'analytics'), orderBy('timestamp', 'desc'), limit(10));
            onSnapshot(analyticsQuery, (snapshot) => {
                refreshAnalytics();
            });
        }

        // Form handling
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            if (!checkRateLimit()) {
                showNotification('Rate limit exceeded. Please wait before sending another message.', 'error');
                return;
            }

            const formData = new FormData(event.target);
            const messageData = {
                name: formData.get('name'),
                email: formData.get('email'),
                message: formData.get('message'),
                clientTimestamp: new Date().toISOString()
            };

            try {
                await saveMessage(messageData);
                event.target.reset();
                updateCharCount();
                updateSubmissionCount();
                await logEasterEgg('form_submission');
            } catch (error) {
                console.error('Error submitting form:', error);
            }
        }

        // Rate limiting
        function checkRateLimit() {
            const now = Date.now();
            const twoMinutes = 2 * 60 * 1000;
            
            if (now - lastSubmissionTime > twoMinutes) {
                submissionCount = 0;
                lastSubmissionTime = now;
            }
            
            return submissionCount < 5;
        }

        function updateSubmissionCount() {
            const now = Date.now();
            const twoMinutes = 2 * 60 * 1000;
            
            if (now - lastSubmissionTime > twoMinutes) {
                submissionCount = 0;
            }
            
            if (submissionCount > 0) {
                lastSubmissionTime = now;
                submissionCount++;
            } else {
                submissionCount = 1;
                lastSubmissionTime = now;
            }
            
            localStorage.setItem('submissionCount', submissionCount.toString());
            localStorage.setItem('lastSubmissionTime', lastSubmissionTime.toString());
            
            document.getElementById('submissionCount').textContent = submissionCount;
        }

        // Terminal functions
        window.activateTerminal = function() {
            document.getElementById('terminal').classList.add('active');
            document.getElementById('terminalInput').focus();
            logEasterEgg('terminal_activated');
        };

        window.closeTerminal = function() {
            document.getElementById('terminal').classList.remove('active');
        };

        window.handleTerminalInput = async function(event) {
            if (event.key === 'Enter') {
                const input = event.target.value.trim();
                const output = document.getElementById('terminalOutput');
                
                // Add command to history
                commandHistory.push(input);
                
                // Display command
                const commandDiv = document.createElement('div');
                commandDiv.innerHTML = `<span style="color: #00ff41;">user@portfolio:~$</span> ${input}`;
                output.appendChild(commandDiv);
                
                // Process command
                const response = await processCommand(input);
                const responseDiv = document.createElement('div');
                responseDiv.innerHTML = response;
                output.appendChild(responseDiv);
                
                // Save to Firebase
                await saveCommand(input, response);
                
                // Clear input and scroll to bottom
                event.target.value = '';
                output.scrollTop = output.scrollHeight;
            }
        };

        async function processCommand(command) {
            const cmd = command.toLowerCase().trim();
            
            switch (cmd) {
                case 'help':
                    return `Available commands:
• help - Show this help message
• matrix - Enter the Matrix
• joke - Tell a random joke
• secret - Reveal a secret
• clear - Clear terminal
• whoami - Show user info
• date - Show current date
• ls - List available features
• dev-mode - Show dev mode info
• sudo dev-mode --enable - Enable super dev mode
• analytics - Show analytics (dev mode only)
• export - Export data (dev mode only)
• blackout - Toggle blackout mode (terminal exclusive)
• hunt - Start the ultimate easter egg hunt
• progress - Show your hunt progress (requires sign in)`;

                case 'hunt':
                    await logEasterEgg('hunt_command_used');
                    return `🎯 EASTER EGG HUNT DISCOVERED!
                    
🔍 You've found the secret hunt command!
🚀 Ready for the ultimate developer challenge?

Visit: begin/index.html

This will take you to the official Easter Egg Hunt starting point with:
• 15+ hidden easter eggs throughout the portfolio
• Advanced developer challenges
• Console puzzles and hidden commands
• Secret key combinations and sequences
• Firebase-tracked progress

⚠️  WARNING: This hunt requires expert web development skills!

Good luck, detective! 🕵️‍♂️`;

                case 'progress':
                    return await getHuntProgress();

                case 'matrix':
                    activateMatrix();
                    await logEasterEgg('matrix_activated');
                    return '🎊 CONGRATULATIONS! 🎊\nYou\'ve unlocked the Matrix! You might actually be a detective...';

                case 'joke':
                    const jokes = [
                        'Why do programmers prefer dark mode? Because light attracts bugs!',
                        'How many programmers does it take to change a light bulb? None, that\'s a hardware problem.',
                        'Why do Java developers wear glasses? Because they can\'t C#!',
                        'A SQL query goes into a bar, walks up to two tables and asks: "Can I join you?"'
                    ];
                    return jokes[Math.floor(Math.random() * jokes.length)];

                case 'secret':
                    await logEasterEgg('secret_revealed');
                    return '🔐 Secret revealed: The Konami Code works on this site! ↑↑↓↓←→←→BA';

                case 'clear':
                    document.getElementById('terminalOutput').innerHTML = '<div>Terminal cleared. Type \'help\' for commands.</div>';
                    return '';

                case 'whoami':
                    return `User: Anonymous Visitor\nSession: ${sessionId}\nLocation: Unknown\nSkill Level: Curious Developer`;

                case 'date':
                    return new Date().toString();

                case 'ls':
                    return `Available features:
• 🎮 Secret projects
• 🔧 Developer tools
• 📊 Analytics dashboard
• 🎯 Easter egg hunter
• 💻 Code inspector`;

                case 'dev-mode':
                    return devModeEnabled ? 
                        '🔧 Super Dev Mode: ENABLED\nAccess to advanced features unlocked!' :
                        '🔒 Super Dev Mode: DISABLED\nUse "sudo dev-mode --enable" to unlock';

                case 'sudo dev-mode --enable':
                    if (!devModeEnabled) {
                        devModeEnabled = true;
                        await logEasterEgg('dev_mode_enabled');
                        showNotification('🔧 Super Dev Mode Activated!');
                        // Show dev panel button
                        const devPanelBtn = document.getElementById('dev-panel-btn');
                        if (devPanelBtn) devPanelBtn.style.display = 'inline-block';
                        // Enable dev panel
                        const devPanel = document.getElementById('devPanel');
                        if (devPanel) devPanel.classList.add('enabled');
                        return '🎉 SUPER DEV MODE ACTIVATED!\n✅ Analytics access granted\n✅ Database tools unlocked\n✅ Advanced features enabled\n✅ Export capabilities available\n✅ Dev Panel button now visible!';
                    }
                    return 'Super Dev Mode already enabled!';

                case 'analytics':
                    if (devModeEnabled) {
                        const analytics = await getAnalytics();
                        return analytics ? 
                            `📊 Live Analytics:
• Page Views: ${analytics.pageViews}
• Active Users: ${analytics.activeUsers}  
• Messages: ${analytics.messageCount}
• Easter Eggs Found: ${analytics.easterEggCount}` 
                            : 'Error loading analytics';
                    }
                    return '🔒 Access denied. Enable dev mode first.';

                case 'export':
                    if (devModeEnabled) {
                        exportData();
                        return '📤 Data export initiated. Check downloads folder.';
                    }
                    return '🔒 Access denied. Enable dev mode first.';

                case 'blackout':
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    if (currentTheme === 'blackout') {
                        document.documentElement.setAttribute('data-theme', 'dark');
                        localStorage.setItem('theme', 'dark');
                        updateThemeButton();
                        await logEasterEgg('blackout_mode_disabled');
                        return '🌙 Blackout mode disabled. Returned to dark theme.';
                    } else {
                        document.documentElement.setAttribute('data-theme', 'blackout');
                        localStorage.setItem('theme', 'blackout');
                        updateThemeButton();
                        await logEasterEgg('blackout_mode_enabled');
                        return '⚫ BLACKOUT MODE ACTIVATED!\n🖤 Pure darkness engaged\n💀 Matrix-style green accents\n🔴 Red danger highlights\n⚠️ This mode is terminal exclusive!';
                    }

                default:
                    return `Command not found: ${command}\nType 'help' for available commands.`;
            }
        }

        // Matrix effect
        function initializeMatrix() {
            const canvas = document.getElementById('matrixCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()';
            const charArray = chars.split('');
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            const drops = [];
            
            for (let i = 0; i < columns; i++) {
                drops[i] = 1;
            }
            
            function drawMatrix() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#00ff41';
                ctx.font = fontSize + 'px monospace';
                
                for (let i = 0; i < drops.length; i++) {
                    const text = charArray[Math.floor(Math.random() * charArray.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            
            setInterval(drawMatrix, 50);
        }

        function activateMatrix() {
            document.body.classList.add('matrix-mode');
            setTimeout(() => {
                document.body.classList.remove('matrix-mode');
            }, 10000);
        }

        // UI Functions
        window.toggleTheme = function() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            // Only toggle between light and dark (not blackout)
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton();
            
            logEasterEgg('theme_toggled');
        };

        function updateThemeButton() {
            const theme = document.documentElement.getAttribute('data-theme') || 'dark';
            const button = document.querySelector('.theme-toggle');
            if (theme === 'light') {
                button.textContent = '🌙 Dark';
            } else if (theme === 'blackout') {
                button.textContent = '⚫ Blackout';
            } else {
                button.textContent = '☀️ Light';
            }
        }

        window.scrollToProjects = function() {
            showSection('projects');
        };

        window.toggleDevPanel = function() {
            document.getElementById('devPanel').classList.toggle('active');
            logEasterEgg('dev_panel_toggled');
        };

        window.generateEasterEgg = function() {
            const easterEggs = [
                '🎯 Found: The secret is in the source code!',
                '🔍 Discovery: Try the Konami code!',
                '🎮 Hidden: There\'s a secret game mode!',
                '💎 Gem: Check the console for messages!',
                '🗝️ Key: The terminal has super powers!'
            ];
            
            const randomEgg = easterEggs[Math.floor(Math.random() * easterEggs.length)];
            showNotification(randomEgg);
            logEasterEgg('random_easter_egg');
        };

        // Project functions
        window.unlockSecretProject = function() {
            showNotification('🎮 Secret Project: Try typing "matrix" in the terminal!');
            logEasterEgg('secret_project_hint');
        };

        window.inspectCode = function() {
            console.log('🔍 Code Inspector Activated!');
            console.log('🎯 Easter Egg: You\'re already inspecting the code!');
            console.log('🚀 BONUS: Want the ultimate challenge? Visit: begin/index.html');
            showNotification('Check the console for a surprise! 🕵️');
            logEasterEgg('code_inspector_used');
        };

        window.huntEasterEggs = function() {
            const hints = [
                'Try the terminal commands!',
                'Check the matrix effect!',
                'Look for hidden keyboard shortcuts!',
                'The developer panel has secrets!',
                'Try different theme toggles!',
                '🎯 ULTIMATE HUNT: Visit begin/index.html for the full challenge!'
            ];
            
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            showNotification(`🔍 Hint: ${randomHint}`);
            logEasterEgg('easter_egg_hunt');
        };

        window.showAnalytics = async function() {
            const analytics = await getAnalytics();
            if (analytics) {
                showNotification(`📊 Analytics: ${analytics.pageViews} views, ${analytics.messageCount} messages sent!`);
            }
            logEasterEgg('analytics_viewed');
        };

        // Dev panel functions
        window.refreshAnalytics = async function() {
            const analytics = await getAnalytics();
            if (analytics) {
                document.getElementById('pageViews').textContent = analytics.pageViews;
                document.getElementById('activeUsers').textContent = analytics.activeUsers;
                document.getElementById('messageCount').textContent = analytics.messageCount;
            }
        };

        window.resetEasterEggs = function() {
            easterEggsFound = 0;
            localStorage.setItem('easterEggsFound', '0');
            updateEasterEggCount();
            showNotification('Easter egg count reset!');
        };

        window.exportData = async function() {
            if (!devModeEnabled) {
                showNotification('🔒 Dev mode required for export', 'error');
                return;
            }
            
            try {
                const data = {
                    sessionId: sessionId,
                    easterEggsFound: easterEggsFound,
                    commandHistory: commandHistory,
                    timestamp: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dan-finn-portfolio-data-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('📤 Data exported successfully!');
                logEasterEgg('data_exported');
            } catch (error) {
                showNotification('Error exporting data', 'error');
            }
        };

        window.clearCache = function() {
            localStorage.clear();
            sessionStorage.clear();
            showNotification('🗑️ Cache cleared!');
            logEasterEgg('cache_cleared');
        };

        window.testConnection = async function() {
            try {
                await addDoc(collection(db, 'dev_logs'), {
                    type: 'connection_test',
                    timestamp: serverTimestamp(),
                    status: 'success'
                });
                showNotification('✅ Firebase connection successful!');
            } catch (error) {
                showNotification('❌ Firebase connection failed', 'error');
            }
        };

        // Utility functions
        function updateCharCount() {
            const textarea = document.getElementById('message');
            const charCount = document.getElementById('charCount');
            charCount.textContent = textarea.value.length;
        }

        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        function loadEasterEggCount() {
            easterEggsFound = parseInt(localStorage.getItem('easterEggsFound') || '0');
            updateEasterEggCount();
        }

        function updateEasterEggCount() {
            document.getElementById('easterEggCount').textContent = easterEggsFound;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.style.background = type === 'error' ? '#ff4757' : 'var(--accent-color)';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Konami Code Easter Egg
        let konamiCode = '';
        const konamiSequence = 'ArrowUpArrowUpArrowDownArrowDownArrowLeftArrowRightArrowLeftArrowRightKeyBKeyA';
        
        document.addEventListener('keydown', function(event) {
            konamiCode += event.code;
            if (konamiCode.length > konamiSequence.length) {
                konamiCode = konamiCode.slice(-konamiSequence.length);
            }
            
            if (konamiCode === konamiSequence) {
                activateMatrix();
                showNotification('🎊 KONAMI CODE ACTIVATED! Welcome to the Matrix!');
                logEasterEgg('konami_code_activated');
                konamiCode = '';
            }
        });

        // Initialize analytics on load
        setTimeout(() => {
            refreshAnalytics();
        }, 2000);

        // Make functions globally available
        window.db = db;
        window.devModeEnabled = () => devModeEnabled;
        window.getSessionId = () => sessionId;
    </script>
</body>
</html>