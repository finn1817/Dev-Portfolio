<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contact (Inline)</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    const app = initializeApp({
      apiKey: "AIzaSyCejm0Ry18S1mlqYpnMRuIJGnQ-iDvu3EU",
      authDomain: "custom-messages-84ec4.firebaseapp.com",
      projectId: "custom-messages-84ec4",
      storageBucket: "custom-messages-84ec4.firebasestorage.app",
      messagingSenderId: "1079020496100",
      appId: "1:1079020496100:web:d21ec1428327515e3df8f1",
    });
    const db = getFirestore(app);
    window.firebaseDB = db; window.firebaseAddDoc = addDoc; window.firebaseCollection = collection; window.firebaseServerTimestamp = serverTimestamp;
    console.log('üî• Firebase initialized successfully (contact)!');
  </script>
  <style>
    :root{--primary:#6366f1;--secondary:#8b5cf6;--text:#1f2937;--card:#fff}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:linear-gradient(135deg,#667eea,#764ba2);color:var(--text)}
    header{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:rgba(255,255,255,.9);backdrop-filter:blur(10px)}
    a{color:inherit;text-decoration:none;font-weight:600}
    .theme-toggle-container{display:flex;align-items:center;gap:.5rem}
    .theme-slider{position:relative;width:50px;height:25px;background:#4ade80;border-radius:25px;cursor:pointer;border:2px solid var(--primary)}
    .theme-slider.dark{background:#ef4444}
    .theme-slider::before{content:"";position:absolute;top:2px;left:2px;width:17px;height:17px;background:#fff;border-radius:50%;transition:transform .3s ease}
    .theme-slider.dark::before{transform:translateX(23px)}
    [data-theme=dark] body{background:linear-gradient(135deg,#0f172a,#111827)!important;color:#f8fafc}
    main{max-width:800px;margin:2rem auto;padding:1rem}
    form{display:flex;flex-direction:column;gap:.8rem;background:rgba(255,255,255,.85);padding:1rem;border-radius:12px}
    input,textarea{padding:1rem;border:1px solid #ddd;border-radius:10px;font-size:1rem}
    button{background:var(--primary);color:#fff;border:none;padding:1rem;border-radius:10px;cursor:pointer;font-weight:700}
    .char{font-size:.85rem;color:#555;text-align:right}
    .info{margin-top:1rem;padding:.6rem;background:rgba(245,158,11,.1);border:1px solid #f59e0b;border-radius:8px;color:#a36200}
  </style>
</head>
<body>
  <header>
    <a href="index-inline.html">‚Üê Back</a>
    <div class="theme-toggle-container">
      <span class="light-label">Light</span>
      <div class="theme-slider" id="theme-slider"></div>
      <span class="dark-label">Dark</span>
    </div>
  </header>
  <main>
    <h1>Contact</h1>
    <p>Same Firestore-backed contact form, all inline.</p>
    <form id="contact-form">
      <input type="text" name="name" placeholder="Your name (optional)" />
      <input type="email" name="email" id="email" placeholder="Your email *" required />
      <textarea name="message" id="message" placeholder="Your message *" required maxlength="2000"></textarea>
      <div class="char"><span id="count">0</span>/2000</div>
      <button type="submit" id="send">Send Message</button>
    </form>
    <div class="info" id="rate" style="display:none">‚è∞ Rate limit: <span id="num">0</span>/5 in last 2 minutes</div>
  </main>
  <script>
    // Theme
    function applyTheme(theme){ document.documentElement.setAttribute('data-theme',theme); document.getElementById('theme-slider').classList.toggle('dark', theme==='dark'); }
    applyTheme(localStorage.getItem('theme')||'light');
    document.getElementById('theme-slider').addEventListener('click',()=>{ const next=(document.documentElement.getAttribute('data-theme')||'light')==='dark'?'light':'dark'; localStorage.setItem('theme',next); applyTheme(next); });

    // Form
    const form=document.getElementById('contact-form');
    const email=document.getElementById('email');
    const message=document.getElementById('message');
    const count=document.getElementById('count');
    const rate=document.getElementById('rate');
    const num=document.getElementById('num');

    message.addEventListener('input',()=>{ const len=message.value.length; count.textContent=len; });

    function getSubs(){ try{return JSON.parse(localStorage.getItem('formSubmissions')||'[]');}catch{return []} }
    function setSub(){ const s=getSubs(); s.push(Date.now()); localStorage.setItem('formSubmissions',JSON.stringify(s)); const two=Date.now()-(2*60*1000); const r=s.filter(t=>t>two); num.textContent=r.length; rate.style.display=r.length>0?'block':'none'; }
    (function(){ const s=getSubs(); const two=Date.now()-(2*60*1000); const r=s.filter(t=>t>two); num.textContent=r.length; rate.style.display=r.length>0?'block':'none'; })();

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data={ name: (new FormData(form)).get('name')||'', email: email.value, message: message.value, serverTimestamp: window.firebaseServerTimestamp(), clientTimestamp: new Date().toISOString() };
      const re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/; if(!re.test(data.email)) { alert('Invalid email'); return; }
      if (data.message.length < 10) { alert('Message too short'); return; }
      const btn=document.getElementById('send'); btn.disabled=true; btn.textContent='Sending...';
      try {
        const rnd=Math.floor(1000+Math.random()*9000); const t=new Date(); const id=`${rnd}-${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`;
        await window.firebaseAddDoc(window.firebaseCollection(window.firebaseDB,'Messages'), { id, ...data });
        alert('‚úÖ Message sent!'); form.reset(); count.textContent='0'; setSub();
      } catch(e){ console.error(e); alert('‚ùå Failed to send'); }
      finally { btn.disabled=false; btn.textContent='Send Message'; }
    });
  </script>
</body>
</html>
